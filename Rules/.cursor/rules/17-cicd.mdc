---
description: –ü—Ä–∞–≤–∏–ª–∞ CI/CD. GitHub Actions, –ø–∞–π–ø–ª–∞–π–Ω—ã, –¥–µ–ø–ª–æ–π.
globs: [".github/**", "**/Dockerfile", "**/docker-compose*"]
alwaysApply: false
---

# –ü–†–ê–í–ò–õ–ê CI/CD

> –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è = –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å. –ö–∞–∂–¥—ã–π –∫–æ–º–º–∏—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.

---

## üéØ –ì–õ–ê–í–ù–´–ï –ü–†–ò–ù–¶–ò–ü–´

1. **Fail Fast** ‚Äî –ª–æ–≤–∏–º –æ—à–∏–±–∫–∏ –∫–∞–∫ –º–æ–∂–Ω–æ —Ä–∞–Ω—å—à–µ
2. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** ‚Äî –º–∏–Ω–∏–º—É–º —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
3. **Reproducible** ‚Äî –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∂–¥—ã–π —Ä–∞–∑
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub Secrets

---

## üì¶ –°–¢–†–£–ö–¢–£–†–ê –ü–ê–ô–ü–õ–ê–ô–ù–ê

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                       CI PIPELINE                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Install ‚îÇ  Lint   ‚îÇ  Type   ‚îÇ  Test   ‚îÇ  Build  ‚îÇ Security ‚îÇ
‚îÇ         ‚îÇ         ‚îÇ  Check  ‚îÇ         ‚îÇ         ‚îÇ  Audit   ‚îÇ
‚îÇ  deps   ‚îÇ ESLint  ‚îÇ   tsc   ‚îÇ  Jest   ‚îÇ Next.js ‚îÇ   npm    ‚îÇ
‚îÇ         ‚îÇ Prettier‚îÇ         ‚îÇPlaywright‚îÇ         ‚îÇ  audit   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                       CD PIPELINE                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ     Preview     ‚îÇ     Staging     ‚îÇ      Production         ‚îÇ
‚îÇ                 ‚îÇ                 ‚îÇ                         ‚îÇ
‚îÇ   PR preview    ‚îÇ   develop ‚Üí     ‚îÇ   main ‚Üí                ‚îÇ
‚îÇ   environments  ‚îÇ   staging env   ‚îÇ   production env        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß GITHUB ACTIONS

### CI Workflow

```yaml
# .github/workflows/ci.yml
name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

# –û—Ç–º–µ–Ω—è—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–ø—É—Å–∫–∏ –¥–ª—è —Ç–æ–≥–æ –∂–µ PR
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

env:
  NODE_VERSION: '20'
  PNPM_VERSION: '8'

jobs:
  # ==========================================
  # LINT & TYPECHECK
  # ==========================================
  lint:
    name: Lint & Typecheck
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'pnpm'

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Lint
        run: pnpm lint

      - name: Type check
        run: pnpm type-check

      - name: Format check
        run: pnpm format:check

  # ==========================================
  # TEST
  # ==========================================
  test:
    name: Test
    runs-on: ubuntu-latest
    needs: lint
    
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_USER: test
          POSTGRES_PASSWORD: test
          POSTGRES_DB: test
        ports:
          - 5432:5432
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'pnpm'

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Generate Prisma Client
        run: pnpm prisma generate

      - name: Run migrations
        run: pnpm prisma migrate deploy
        env:
          DATABASE_URL: postgresql://test:test@localhost:5432/test

      - name: Run unit tests
        run: pnpm test:unit
        env:
          DATABASE_URL: postgresql://test:test@localhost:5432/test

      - name: Run integration tests
        run: pnpm test:integration
        env:
          DATABASE_URL: postgresql://test:test@localhost:5432/test

      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          files: ./coverage/lcov.info
          fail_ci_if_error: false

  # ==========================================
  # BUILD
  # ==========================================
  build:
    name: Build
    runs-on: ubuntu-latest
    needs: [lint, test]
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'pnpm'

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Build
        run: pnpm build
        env:
          # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ env –¥–ª—è —Å–±–æ—Ä–∫–∏
          NEXT_PUBLIC_API_URL: https://api.example.com

      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: build
          path: .next
          retention-days: 1

  # ==========================================
  # SECURITY
  # ==========================================
  security:
    name: Security Audit
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: Audit dependencies
        run: pnpm audit --prod
        continue-on-error: true  # –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º

      - name: Check for secrets
        uses: trufflesecurity/trufflehog@main
        with:
          extra_args: --only-verified
```

### CD Workflow

```yaml
# .github/workflows/deploy.yml
name: Deploy

on:
  push:
    branches: [main, develop]
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to deploy'
        required: true
        default: 'staging'
        type: choice
        options:
          - staging
          - production

jobs:
  # ==========================================
  # DEPLOY STAGING (develop branch)
  # ==========================================
  deploy-staging:
    name: Deploy to Staging
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/develop'
    environment:
      name: staging
      url: https://staging.example.com
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Deploy to Vercel (Staging)
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod --env staging'
          alias-domains: staging.example.com

  # ==========================================
  # DEPLOY PRODUCTION (main branch)
  # ==========================================
  deploy-production:
    name: Deploy to Production
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    environment:
      name: production
      url: https://example.com
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # Database migrations
      - name: Run migrations
        run: |
          npx prisma migrate deploy
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}

      - name: Deploy to Vercel (Production)
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod'

      - name: Notify on success
        if: success()
        run: |
          curl -X POST ${{ secrets.SLACK_WEBHOOK }} \
            -H 'Content-type: application/json' \
            -d '{"text":"‚úÖ Deployed to production: ${{ github.sha }}"}'

      - name: Notify on failure
        if: failure()
        run: |
          curl -X POST ${{ secrets.SLACK_WEBHOOK }} \
            -H 'Content-type: application/json' \
            -d '{"text":"‚ùå Production deploy failed: ${{ github.sha }}"}'
```

### Preview Deployments

```yaml
# .github/workflows/preview.yml
name: Preview

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  preview:
    name: Deploy Preview
    runs-on: ubuntu-latest
    environment:
      name: preview
      url: ${{ steps.deploy.outputs.preview-url }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Deploy Preview
        id: deploy
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}

      - name: Comment PR
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `üöÄ Preview deployed: ${{ steps.deploy.outputs.preview-url }}`
            })
```

---

## üê≥ DOCKER

### Dockerfile (Production)

```dockerfile
# Dockerfile
# Multi-stage build –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞

# ==========================================
# DEPENDENCIES
# ==========================================
FROM node:20-alpine AS deps
WORKDIR /app

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è native modules
RUN apk add --no-cache libc6-compat

# –ö–æ–ø–∏—Ä—É–µ–º package files
COPY package.json pnpm-lock.yaml ./
COPY prisma ./prisma/

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN corepack enable pnpm && pnpm install --frozen-lockfile

# ==========================================
# BUILDER
# ==========================================
FROM node:20-alpine AS builder
WORKDIR /app

COPY --from=deps /app/node_modules ./node_modules
COPY . .

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º Prisma Client
RUN npx prisma generate

# Build –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
ENV NEXT_TELEMETRY_DISABLED 1
RUN npm run build

# ==========================================
# RUNNER
# ==========================================
FROM node:20-alpine AS runner
WORKDIR /app

ENV NODE_ENV production
ENV NEXT_TELEMETRY_DISABLED 1

# –°–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ root)
RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

# –ö–æ–ø–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ
COPY --from=builder /app/public ./public
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static
COPY --from=builder /app/prisma ./prisma

# –ü—Ä–∞–≤–∞ –Ω–∞ –ø–∞–ø–∫–∏
RUN chown -R nextjs:nodejs /app

USER nextjs

EXPOSE 3000

ENV PORT 3000
ENV HOSTNAME "0.0.0.0"

CMD ["node", "server.js"]
```

### docker-compose (Development)

```yaml
# docker-compose.yml
version: '3.8'

services:
  # PostgreSQL
  postgres:
    image: postgres:15-alpine
    container_name: app-postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: ${DB_USER:-app}
      POSTGRES_PASSWORD: ${DB_PASSWORD:-password}
      POSTGRES_DB: ${DB_NAME:-app}
    volumes:
      - postgres-data:/var/lib/postgresql/data
    ports:
      - '5432:5432'
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -U ${DB_USER:-app}']
      interval: 10s
      timeout: 5s
      retries: 5

  # Redis
  redis:
    image: redis:7-alpine
    container_name: app-redis
    restart: unless-stopped
    command: redis-server --appendonly yes
    volumes:
      - redis-data:/data
    ports:
      - '6379:6379'
    healthcheck:
      test: ['CMD', 'redis-cli', 'ping']
      interval: 10s
      timeout: 5s
      retries: 5

  # App (–¥–ª—è production-like testing)
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: app
    restart: unless-stopped
    environment:
      DATABASE_URL: postgresql://${DB_USER:-app}:${DB_PASSWORD:-password}@postgres:5432/${DB_NAME:-app}
      REDIS_URL: redis://redis:6379
      NODE_ENV: production
    ports:
      - '3000:3000'
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy

volumes:
  postgres-data:
  redis-data:
```

---

## üìú SCRIPTS (package.json)

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    
    "lint": "next lint",
    "lint:fix": "next lint --fix",
    "format": "prettier --write .",
    "format:check": "prettier --check .",
    "type-check": "tsc --noEmit",
    
    "test": "jest",
    "test:unit": "jest --testPathPattern=unit",
    "test:integration": "jest --testPathPattern=integration",
    "test:e2e": "playwright test",
    "test:coverage": "jest --coverage",
    
    "db:generate": "prisma generate",
    "db:migrate": "prisma migrate dev",
    "db:migrate:deploy": "prisma migrate deploy",
    "db:push": "prisma db push",
    "db:seed": "prisma db seed",
    "db:studio": "prisma studio",
    
    "docker:up": "docker-compose up -d",
    "docker:down": "docker-compose down",
    "docker:logs": "docker-compose logs -f",
    
    "prepare": "husky install"
  }
}
```

---

## üîê –°–ï–ö–†–ï–¢–´

### GitHub Secrets

```markdown
## –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã

| –°–µ–∫—Ä–µ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `DATABASE_URL` | Connection string –∫ –ë–î |
| `VERCEL_TOKEN` | –¢–æ–∫–µ–Ω Vercel |
| `VERCEL_ORG_ID` | ID –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ Vercel |
| `VERCEL_PROJECT_ID` | ID –ø—Ä–æ–µ–∫—Ç–∞ Vercel |

## –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ

| –°–µ–∫—Ä–µ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `SLACK_WEBHOOK` | Webhook –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| `CODECOV_TOKEN` | –¢–æ–∫–µ–Ω Codecov |
| `SENTRY_DSN` | DSN –¥–ª—è Sentry |
```

### Environments

```yaml
# GitHub Environments:
# - preview (–¥–ª—è PR)
# - staging (develop branch)
# - production (main branch, —Ç—Ä–µ–±—É–µ—Ç approval)
```

---

## üö© FEATURE FLAGS

### –ó–∞—á–µ–º –Ω—É–∂–Ω—ã

- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π rollout –Ω–æ–≤—ã—Ö —Ñ–∏—á
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- Kill switch –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ñ–∏—á
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ deploy –∏ release

### –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

```typescript
// lib/feature-flags.ts

type FeatureFlag = {
  enabled: boolean;
  percentage?: number;  // –î–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ rollout
  allowedUsers?: string[];  // –î–ª—è beta-—Ç–µ—Å—Ç–µ—Ä–æ–≤
};

const FLAGS: Record<string, FeatureFlag> = {
  'new-checkout': {
    enabled: true,
    percentage: 10,  // 10% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  },
  'dark-mode': {
    enabled: true,
    allowedUsers: ['user-123', 'user-456'],
  },
  'experimental-search': {
    enabled: false,
  },
};

export function isFeatureEnabled(
  flagName: string,
  userId?: string,
): boolean {
  const flag = FLAGS[flagName];
  if (!flag || !flag.enabled) return false;

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö
  if (flag.allowedUsers?.includes(userId ?? '')) {
    return true;
  }

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç
  if (flag.percentage !== undefined && userId) {
    const hash = simpleHash(userId + flagName);
    return (hash % 100) < flag.percentage;
  }

  return flag.enabled;
}

function simpleHash(str: string): number {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    hash = ((hash << 5) - hash) + str.charCodeAt(i);
    hash |= 0;
  }
  return Math.abs(hash);
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```tsx
// –í React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ
function CheckoutPage() {
  const { user } = useAuth();
  const showNewCheckout = isFeatureEnabled('new-checkout', user?.id);

  if (showNewCheckout) {
    return <NewCheckout />;
  }
  return <OldCheckout />;
}

// –í API
@Get('search')
async search(@Query() query: SearchDto, @CurrentUser() user: User) {
  if (isFeatureEnabled('experimental-search', user?.id)) {
    return this.experimentalSearch(query);
  }
  return this.classicSearch(query);
}
```

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è

```markdown
## –°–µ—Ä–≤–∏—Å—ã Feature Flags

| –°–µ—Ä–≤–∏—Å | –ü–ª—é—Å—ã | –ú–∏–Ω—É—Å—ã |
|--------|-------|--------|
| LaunchDarkly | –ú–æ—â–Ω—ã–π, A/B, analytics | –î–æ—Ä–æ–≥–æ |
| Unleash | Open source, self-hosted | –ù—É–∂–Ω–æ —Ö–æ—Å—Ç–∏—Ç—å |
| ConfigCat | –ü—Ä–æ—Å—Ç–æ–π, –¥–µ—à—ë–≤—ã–π | –ú–µ–Ω—å—à–µ —Ñ–∏—á |
| Flagsmith | Open source, —Ö–æ—Ä–æ—à–∏–π UI | –ú–æ–ª–æ–¥–æ–π |
| Env vars | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ, –ø—Ä–æ—Å—Ç–æ | –¢—Ä–µ–±—É–µ—Ç redeploy |
```

### Environment-based Flags

```typescript
// –ü—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç —á–µ—Ä–µ–∑ env
const FEATURES = {
  NEW_CHECKOUT: process.env.FEATURE_NEW_CHECKOUT === 'true',
  DARK_MODE: process.env.FEATURE_DARK_MODE === 'true',
};

// .env.staging
FEATURE_NEW_CHECKOUT=true
FEATURE_DARK_MODE=true

// .env.production
FEATURE_NEW_CHECKOUT=false
FEATURE_DARK_MODE=true
```

### –ü—Ä–∞–≤–∏–ª–∞ Feature Flags

```markdown
## Best Practices

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ
- ‚úÖ `new-checkout`, `experimental-search`
- ‚ùå `flag1`, `test`, `temp`

### Lifecycle
1. –°–æ–∑–¥–∞—Ç—å —Ñ–ª–∞–≥ (disabled)
2. –í–∫–ª—é—á–∏—Ç—å –¥–ª—è dev/staging
3. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π rollout –≤ prod (10% ‚Üí 50% ‚Üí 100%)
4. –£–¥–∞–ª–∏—Ç—å —Ñ–ª–∞–≥ –∏ —Å—Ç–∞—Ä—ã–π –∫–æ–¥

### –ì–∏–≥–∏–µ–Ω–∞
- ‚úÖ –£–¥–∞–ª—è—Ç—å —Ñ–ª–∞–≥–∏ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ rollout
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ñ–ª–∞–≥–∞
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å expiration date
- ‚ùå –ù–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å —Å–æ—Ç–Ω–∏ —Ñ–ª–∞–≥–æ–≤

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ–∫–∞–∑–∞–Ω
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –≤–∞—Ä–∏–∞–Ω—Ç—É
- ‚úÖ –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –Ω–æ–≤—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º
```

---

## üìã CHECKLIST

### CI Pipeline

- [ ] Lint (ESLint)
- [ ] Format check (Prettier)
- [ ] Type check (TypeScript)
- [ ] Unit tests
- [ ] Integration tests
- [ ] Build
- [ ] Security audit

### CD Pipeline

- [ ] Preview deployments –¥–ª—è PR
- [ ] Staging auto-deploy (develop)
- [ ] Production deploy (main, —Å approval)
- [ ] Database migrations
- [ ] Notifications (Slack/Discord)

### Docker

- [ ] Multi-stage build
- [ ] Non-root user
- [ ] Health checks
- [ ] .dockerignore –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### Feature Flags (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)

- [ ] –§–ª–∞–≥–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ï—Å—Ç—å kill switch –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ–∏—á
- [ ] –°—Ç–∞—Ä—ã–µ —Ñ–ª–∞–≥–∏ —É–¥–∞–ª—è—é—Ç—Å—è
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ–∫–∞–∑–∞–Ω

---

**–í–µ—Ä—Å–∏—è:** 1.1
**–î–∞—Ç–∞:** 2025-01-31
