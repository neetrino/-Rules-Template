---
description: –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ —Å—Ö–µ–º–∞–º, –º–∏–≥—Ä–∞—Ü–∏—è–º –∏ –∑–∞–ø—Ä–æ—Å–∞–º.
globs: ["**/prisma/**", "**/*.prisma", "**/db/**", "**/database/**", "**/migrations/**"]
alwaysApply: false
---

# –ü–†–ê–í–ò–õ–ê –†–ê–ë–û–¢–´ –° –ë–ê–ó–û–ô –î–ê–ù–ù–´–•

> PostgreSQL –∫–∞–∫ –æ—Å–Ω–æ–≤–∞. Prisma –∫–∞–∫ ORM. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

---

## üéØ –ì–õ–ê–í–ù–´–ï –ü–†–ò–ù–¶–ò–ü–´

1. **PostgreSQL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** ‚Äî –¥–ª—è 95% –ø—Ä–æ–µ–∫—Ç–æ–≤
2. **Prisma ORM** ‚Äî –Ω–∏–∫–∞–∫–∏—Ö raw SQL –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
3. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã** ‚Äî –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏
4. **–ò–Ω–¥–µ–∫—Å—ã –ø—Ä–æ–¥—É–º–∞–Ω—ã** ‚Äî –¥–ª—è –≤—Å–µ—Ö —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üóÑÔ∏è –í–´–ë–û–† –ë–ê–ó–´ –î–ê–ù–ù–´–•

### –ö–æ–≥–¥–∞ –∫–∞–∫—É—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å | –ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|-------------|-------------------|----------------------|
| **PostgreSQL** | 95% –ø—Ä–æ–µ–∫—Ç–æ–≤, ACID, —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã | –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–æ–µ–∫—Ç—ã |
| **MongoDB** | –î–æ–∫—É–º–µ–Ω—Ç—ã, –≥–∏–±–∫–∞—è —Å—Ö–µ–º–∞, –ø—Ä–æ—Ç–æ—Ç–∏–ø—ã | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Å–≤—è–∑–∏ –¥–∞–Ω–Ω—ã—Ö |
| **SQLite** | –ü—Ä–æ—Ç–æ—Ç–∏–ø—ã, –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | Production web-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| **Redis** | –ö—ç—à, —Å–µ—Å—Å–∏–∏, –æ—á–µ—Ä–µ–¥–∏ | –û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ |

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å—Ç–µ–∫

```
Production:
‚îú‚îÄ‚îÄ PostgreSQL 15+ ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ë–î
‚îú‚îÄ‚îÄ Redis 7+ ‚Äî –∫—ç—à –∏ –æ—á–µ—Ä–µ–¥–∏
‚îî‚îÄ‚îÄ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Elasticsearch ‚Äî –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
```

---

## üìù PRISMA SCHEMA

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ schema.prisma

```prisma
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==========================================
// –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò –ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
// ==========================================

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  role      UserRole @default(USER)
  isActive  Boolean  @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // –°–≤—è–∑–∏
  orders    Order[]
  sessions  Session[]
  
  @@index([email])
  @@index([role, isActive])
  @@map("users")
}

enum UserRole {
  USER
  ADMIN
  MANAGER
}

model Session {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([token])
  @@index([userId])
  @@map("sessions")
}

// ==========================================
// –ü–†–û–î–£–ö–¢–´ –ò –ö–ê–¢–ï–ì–û–†–ò–ò
// ==========================================

model Category {
  id          String  @id @default(cuid())
  slug        String  @unique
  name        String
  description String?
  parentId    String?
  sortOrder   Int     @default(0)
  isActive    Boolean @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // –°–≤—è–∑–∏
  parent   Category?  @relation("CategoryTree", fields: [parentId], references: [id])
  children Category[] @relation("CategoryTree")
  products Product[]
  
  @@index([slug])
  @@index([parentId])
  @@index([isActive, sortOrder])
  @@map("categories")
}

model Product {
  id          String  @id @default(cuid())
  slug        String  @unique
  sku         String? @unique
  name        String
  description String?
  price       Int     // –¶–µ–Ω–∞ –≤ –∫–æ–ø–µ–π–∫–∞—Ö
  comparePrice Int?   // –°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞ –¥–ª—è —Å–∫–∏–¥–∫–∏
  stock       Int     @default(0)
  categoryId  String
  isActive    Boolean @default(true)
  isFeatured  Boolean @default(false)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // –°–≤—è–∑–∏
  category   Category    @relation(fields: [categoryId], references: [id])
  variants   Variant[]
  images     Image[]
  orderItems OrderItem[]
  
  @@index([slug])
  @@index([sku])
  @@index([categoryId])
  @@index([isActive, isFeatured])
  @@index([price])
  @@map("products")
}

model Variant {
  id        String @id @default(cuid())
  productId String
  sku       String @unique
  name      String // "–ö—Ä–∞—Å–Ω—ã–π, L"
  price     Int?   // –°–≤–æ—è —Ü–µ–Ω–∞ –∏–ª–∏ null = —Ü–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞
  stock     Int    @default(0)
  
  // –ê—Ç—Ä–∏–±—É—Ç—ã –∫–∞–∫ JSON
  attributes Json @default("{}")
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  product    Product     @relation(fields: [productId], references: [id], onDelete: Cascade)
  orderItems OrderItem[]
  
  @@index([productId])
  @@index([sku])
  @@map("variants")
}

model Image {
  id        String @id @default(cuid())
  productId String
  url       String
  alt       String?
  sortOrder Int    @default(0)
  
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@index([productId])
  @@map("images")
}

// ==========================================
// –ó–ê–ö–ê–ó–´
// ==========================================

model Order {
  id          String      @id @default(cuid())
  number      String      @unique // ORD-2024-00001
  userId      String?
  status      OrderStatus @default(PENDING)
  
  // –°—É–º–º—ã –≤ –∫–æ–ø–µ–π–∫–∞—Ö
  subtotal    Int
  discount    Int         @default(0)
  shipping    Int         @default(0)
  total       Int
  
  // –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏
  shippingAddress Json
  billingAddress  Json?
  
  // –ö–æ–Ω—Ç–∞–∫—Ç
  email       String
  phone       String
  
  // –ú–µ—Ç–∞
  notes       String?
  metadata    Json        @default("{}")
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  // –°–≤—è–∑–∏
  user        User?       @relation(fields: [userId], references: [id])
  items       OrderItem[]
  payments    Payment[]
  events      OrderEvent[]
  
  @@index([number])
  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("orders")
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

model OrderItem {
  id        String @id @default(cuid())
  orderId   String
  productId String
  variantId String?
  
  name      String // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞
  sku       String
  price     Int    // –¶–µ–Ω–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞
  quantity  Int
  total     Int    // price * quantity
  
  order   Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product  @relation(fields: [productId], references: [id])
  variant Variant? @relation(fields: [variantId], references: [id])
  
  @@index([orderId])
  @@map("order_items")
}

model OrderEvent {
  id        String   @id @default(cuid())
  orderId   String
  type      String   // status_changed, payment_received, note_added
  data      Json     @default("{}")
  createdAt DateTime @default(now())
  createdBy String?  // User ID –∏–ª–∏ 'system'
  
  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  @@index([orderId])
  @@index([type])
  @@map("order_events")
}

model Payment {
  id            String        @id @default(cuid())
  orderId       String
  provider      String        // stripe, idram, arca
  externalId    String?       @unique
  status        PaymentStatus @default(PENDING)
  amount        Int
  currency      String        @default("AMD")
  metadata      Json          @default("{}")
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  order Order @relation(fields: [orderId], references: [id])
  
  @@index([orderId])
  @@index([externalId])
  @@index([status])
  @@map("payments")
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}
```

---

## üîß –ü–†–ê–í–ò–õ–ê –°–•–ï–ú–´

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ

```prisma
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
model User { ... }           // PascalCase –¥–ª—è –º–æ–¥–µ–ª–µ–π
model OrderItem { ... }      // PascalCase —Å–æ—Å—Ç–∞–≤–Ω—ã–µ

// –ü–æ–ª—è ‚Äî camelCase
firstName String
createdAt DateTime
isActive  Boolean

// Enum ‚Äî UPPER_SNAKE –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π
enum OrderStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

// –¢–∞–±–ª–∏—Ü—ã ‚Äî snake_case —á–µ—Ä–µ–∑ @@map
model OrderItem {
  ...
  @@map("order_items")
}
```

### ID —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

```prisma
// ‚úÖ CUID ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è (–∫–æ—Ä–æ—á–µ UUID, —Å–æ—Ä—Ç–∏—Ä—É–µ–º—ã–π)
id String @id @default(cuid())

// ‚úÖ UUID ‚Äî –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
id String @id @default(uuid())

// ‚ö†Ô∏è Auto-increment ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü
id Int @id @default(autoincrement())
```

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è

```prisma
// ‚úÖ –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π timestamps
model Entity {
  id        String   @id @default(cuid())
  // ... –ø–æ–ª—è
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

---

## üìä –ò–ù–î–ï–ö–°–´

### –ö–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è—Ç—å –∏–Ω–¥–µ–∫—Å—ã

```prisma
// ‚úÖ –ü–æ–ª—è –¥–ª—è –ø–æ–∏—Å–∫–∞
@@index([email])
@@index([slug])

// ‚úÖ –ü–æ–ª—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
@@index([status])
@@index([isActive])
@@index([categoryId])

// ‚úÖ –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
@@index([isActive, createdAt])
@@index([userId, status])

// ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
email String @unique
slug  String @unique

// ‚úÖ –°–æ—Å—Ç–∞–≤–Ω–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π
@@unique([productId, variantId])
```

### –ß—Ç–æ –ù–ï –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å

```prisma
// ‚ùå –ù–µ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–π:
// - –ü–æ–ª—è —Å –Ω–∏–∑–∫–æ–π –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é (boolean —Å 50/50)
// - –†–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ WHERE
// - –ë–æ–ª—å—à–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è (description)
```

---

## üîÑ –ú–ò–ì–†–ê–¶–ò–ò

### Workflow –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# 1. –ò–∑–º–µ–Ω–∏—Ç—å schema.prisma

# 2. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (development)
npx prisma migrate dev --name add_user_role

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (production)
npx prisma migrate deploy

# 4. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç
npx prisma generate
```

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞
add_users_table
add_user_email_index
add_order_status_column
rename_price_to_amount
remove_deprecated_field

# ‚ùå –ü–õ–û–•–û
update
fix
changes
migration1
```

### –û–ø–∞—Å–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```prisma
// ‚ö†Ô∏è –û–°–¢–û–†–û–ñ–ù–û ‚Äî –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö

// –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏
// –°–ù–ê–ß–ê–õ–ê: —É–±–µ–¥–∏—Å—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω—É–∂–Ω—ã –∏–ª–∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã

// –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏  
// –ò–°–ü–û–õ–¨–ó–£–ô: @map –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
model User {
  firstName String @map("first_name") // –ë—ã–ª–æ first_name –≤ –ë–î
}

// –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞
// –°–û–ó–î–ê–ô: –Ω–æ–≤—É—é –∫–æ–ª–æ–Ω–∫—É, –º–∏–≥—Ä–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ, —É–¥–∞–ª–∏ —Å—Ç–∞—Ä—É—é
```

---

## üìù –ó–ê–ü–†–û–°–´ PRISMA

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

```typescript
// ‚úÖ Select —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
const users = await prisma.user.findMany({
  select: {
    id: true,
    name: true,
    email: true,
  },
});

// ‚úÖ Include –¥–ª—è —Å–≤—è–∑–µ–π
const order = await prisma.order.findUnique({
  where: { id: orderId },
  include: {
    items: true,
    user: {
      select: { id: true, name: true, email: true },
    },
  },
});

// ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è
const products = await prisma.product.findMany({
  skip: (page - 1) * limit,
  take: limit,
  orderBy: { createdAt: 'desc' },
});

// ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
const [order, payment] = await prisma.$transaction([
  prisma.order.create({ data: orderData }),
  prisma.payment.create({ data: paymentData }),
]);

// ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
const result = await prisma.$transaction(async (tx) => {
  const product = await tx.product.findUnique({ where: { id } });
  
  if (product.stock < quantity) {
    throw new Error('Insufficient stock');
  }
  
  await tx.product.update({
    where: { id },
    data: { stock: { decrement: quantity } },
  });
  
  return tx.orderItem.create({ data: itemData });
});
```

### –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã

```typescript
// ‚ùå N+1 –ø—Ä–æ–±–ª–µ–º–∞
const orders = await prisma.order.findMany();
for (const order of orders) {
  const items = await prisma.orderItem.findMany({
    where: { orderId: order.id },
  }); // N –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤!
}

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π include
const orders = await prisma.order.findMany({
  include: { items: true },
});

// ‚ùå –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
const allProducts = await prisma.product.findMany(); // –ú–∏–ª–ª–∏–æ–Ω—ã –∑–∞–ø–∏—Å–µ–π!

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π –ø–∞–≥–∏–Ω–∞—Ü–∏—é
const products = await prisma.product.findMany({
  take: 100,
  skip: offset,
});

// ‚ùå Raw SQL –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
const users = await prisma.$queryRaw`SELECT * FROM users WHERE ...`;

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π Prisma Query API
const users = await prisma.user.findMany({
  where: { ... },
});
```

---

## üîí –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### –ó–∞—â–∏—Ç–∞ –æ—Ç SQL Injection

```typescript
// ‚úÖ Prisma –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
const user = await prisma.user.findFirst({
  where: { email: userInput }, // –ë–µ–∑–æ–ø–∞—Å–Ω–æ
});

// ‚ö†Ô∏è Raw SQL ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
const result = await prisma.$queryRaw`
  SELECT * FROM users WHERE email = ${userInput}
`; // Prisma —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç

// ‚ùå –ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∏—Ä—É–π —Å—Ç—Ä–æ–∫–∏
const result = await prisma.$queryRawUnsafe(
  `SELECT * FROM users WHERE email = '${userInput}'` // SQL INJECTION!
);
```

### –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

```prisma
model Product {
  id        String    @id @default(cuid())
  // ...
  deletedAt DateTime? // null = –∞–∫—Ç–∏–≤–µ–Ω, –¥–∞—Ç–∞ = —É–¥–∞–ª—ë–Ω
  
  @@index([deletedAt])
}
```

```typescript
// Middleware –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
prisma.$use(async (params, next) => {
  if (params.model === 'Product') {
    if (params.action === 'findMany' || params.action === 'findFirst') {
      params.args.where = {
        ...params.args.where,
        deletedAt: null,
      };
    }
  }
  return next(params);
});
```

---

## üìã CHECKLIST

### –ü–µ—Ä–µ–¥ production

- [ ] –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- [ ] –ù–µ—Ç N+1 –ø—Ä–æ–±–ª–µ–º
- [ ] –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–ª—è –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] Backup –Ω–∞—Å—Ç—Ä–æ–µ–Ω

---

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2025-01-31
