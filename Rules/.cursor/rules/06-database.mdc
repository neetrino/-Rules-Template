---
description: –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ —Å—Ö–µ–º–∞–º, –º–∏–≥—Ä–∞—Ü–∏—è–º –∏ –∑–∞–ø—Ä–æ—Å–∞–º.
globs: ["**/prisma/**", "**/*.prisma", "**/db/**", "**/database/**", "**/migrations/**"]
alwaysApply: false
---

# –ü–†–ê–í–ò–õ–ê –†–ê–ë–û–¢–´ –° –ë–ê–ó–û–ô –î–ê–ù–ù–´–•

> PostgreSQL –∫–∞–∫ –æ—Å–Ω–æ–≤–∞. Prisma –∫–∞–∫ ORM. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

---

## üéØ –ì–õ–ê–í–ù–´–ï –ü–†–ò–ù–¶–ò–ü–´

1. **PostgreSQL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** ‚Äî –¥–ª—è 95% –ø—Ä–æ–µ–∫—Ç–æ–≤
2. **Prisma ORM** ‚Äî –Ω–∏–∫–∞–∫–∏—Ö raw SQL –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
3. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã** ‚Äî –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏
4. **–ò–Ω–¥–µ–∫—Å—ã –ø—Ä–æ–¥—É–º–∞–Ω—ã** ‚Äî –¥–ª—è –≤—Å–µ—Ö —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üóÑÔ∏è –í–´–ë–û–† –ë–ê–ó–´ –î–ê–ù–ù–´–•

### –ö–æ–≥–¥–∞ –∫–∞–∫—É—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å | –ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|-------------|-------------------|----------------------|
| **PostgreSQL** | 95% –ø—Ä–æ–µ–∫—Ç–æ–≤, ACID, —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã | –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–æ–µ–∫—Ç—ã |
| **MongoDB** | –î–æ–∫—É–º–µ–Ω—Ç—ã, –≥–∏–±–∫–∞—è —Å—Ö–µ–º–∞, –ø—Ä–æ—Ç–æ—Ç–∏–ø—ã | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Å–≤—è–∑–∏ –¥–∞–Ω–Ω—ã—Ö |
| **SQLite** | –ü—Ä–æ—Ç–æ—Ç–∏–ø—ã, –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | Production web-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| **Redis** | –ö—ç—à, —Å–µ—Å—Å–∏–∏, –æ—á–µ—Ä–µ–¥–∏ | –û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ |

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å—Ç–µ–∫

```
Production:
‚îú‚îÄ‚îÄ PostgreSQL 15+ ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ë–î
‚îú‚îÄ‚îÄ Redis 7+ ‚Äî –∫—ç—à –∏ –æ—á–µ—Ä–µ–¥–∏
‚îî‚îÄ‚îÄ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Elasticsearch ‚Äî –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
```

---

## üìù PRISMA SCHEMA

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ schema.prisma

```prisma
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==========================================
// –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò –ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
// ==========================================

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  role      UserRole @default(USER)
  isActive  Boolean  @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // –°–≤—è–∑–∏
  orders    Order[]
  sessions  Session[]
  
  @@index([email])
  @@index([role, isActive])
  @@map("users")
}

enum UserRole {
  USER
  ADMIN
  MANAGER
}

model Session {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([token])
  @@index([userId])
  @@map("sessions")
}

// ==========================================
// –ü–†–û–î–£–ö–¢–´ –ò –ö–ê–¢–ï–ì–û–†–ò–ò
// ==========================================

model Category {
  id          String  @id @default(cuid())
  slug        String  @unique
  name        String
  description String?
  parentId    String?
  sortOrder   Int     @default(0)
  isActive    Boolean @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // –°–≤—è–∑–∏
  parent   Category?  @relation("CategoryTree", fields: [parentId], references: [id])
  children Category[] @relation("CategoryTree")
  products Product[]
  
  @@index([slug])
  @@index([parentId])
  @@index([isActive, sortOrder])
  @@map("categories")
}

model Product {
  id          String  @id @default(cuid())
  slug        String  @unique
  sku         String? @unique
  name        String
  description String?
  price       Int     // –¶–µ–Ω–∞ –≤ –∫–æ–ø–µ–π–∫–∞—Ö
  comparePrice Int?   // –°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞ –¥–ª—è —Å–∫–∏–¥–∫–∏
  stock       Int     @default(0)
  categoryId  String
  isActive    Boolean @default(true)
  isFeatured  Boolean @default(false)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // –°–≤—è–∑–∏
  category   Category    @relation(fields: [categoryId], references: [id])
  variants   Variant[]
  images     Image[]
  orderItems OrderItem[]
  
  @@index([slug])
  @@index([sku])
  @@index([categoryId])
  @@index([isActive, isFeatured])
  @@index([price])
  @@map("products")
}

model Variant {
  id        String @id @default(cuid())
  productId String
  sku       String @unique
  name      String // "–ö—Ä–∞—Å–Ω—ã–π, L"
  price     Int?   // –°–≤–æ—è —Ü–µ–Ω–∞ –∏–ª–∏ null = —Ü–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞
  stock     Int    @default(0)
  
  // –ê—Ç—Ä–∏–±—É—Ç—ã –∫–∞–∫ JSON
  attributes Json @default("{}")
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  product    Product     @relation(fields: [productId], references: [id], onDelete: Cascade)
  orderItems OrderItem[]
  
  @@index([productId])
  @@index([sku])
  @@map("variants")
}

model Image {
  id        String @id @default(cuid())
  productId String
  url       String
  alt       String?
  sortOrder Int    @default(0)
  
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@index([productId])
  @@map("images")
}

// ==========================================
// –ó–ê–ö–ê–ó–´
// ==========================================

model Order {
  id          String      @id @default(cuid())
  number      String      @unique // ORD-2024-00001
  userId      String?
  status      OrderStatus @default(PENDING)
  
  // –°—É–º–º—ã –≤ –∫–æ–ø–µ–π–∫–∞—Ö
  subtotal    Int
  discount    Int         @default(0)
  shipping    Int         @default(0)
  total       Int
  
  // –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏
  shippingAddress Json
  billingAddress  Json?
  
  // –ö–æ–Ω—Ç–∞–∫—Ç
  email       String
  phone       String
  
  // –ú–µ—Ç–∞
  notes       String?
  metadata    Json        @default("{}")
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  // –°–≤—è–∑–∏
  user        User?       @relation(fields: [userId], references: [id])
  items       OrderItem[]
  payments    Payment[]
  events      OrderEvent[]
  
  @@index([number])
  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("orders")
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

model OrderItem {
  id        String @id @default(cuid())
  orderId   String
  productId String
  variantId String?
  
  name      String // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞
  sku       String
  price     Int    // –¶–µ–Ω–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞
  quantity  Int
  total     Int    // price * quantity
  
  order   Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product  @relation(fields: [productId], references: [id])
  variant Variant? @relation(fields: [variantId], references: [id])
  
  @@index([orderId])
  @@map("order_items")
}

model OrderEvent {
  id        String   @id @default(cuid())
  orderId   String
  type      String   // status_changed, payment_received, note_added
  data      Json     @default("{}")
  createdAt DateTime @default(now())
  createdBy String?  // User ID –∏–ª–∏ 'system'
  
  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  @@index([orderId])
  @@index([type])
  @@map("order_events")
}

model Payment {
  id            String        @id @default(cuid())
  orderId       String
  provider      String        // stripe, idram, arca
  externalId    String?       @unique
  status        PaymentStatus @default(PENDING)
  amount        Int
  currency      String        @default("AMD")
  metadata      Json          @default("{}")
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  order Order @relation(fields: [orderId], references: [id])
  
  @@index([orderId])
  @@index([externalId])
  @@index([status])
  @@map("payments")
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}
```

---

## üîß –ü–†–ê–í–ò–õ–ê –°–•–ï–ú–´

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ

```prisma
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
model User { ... }           // PascalCase –¥–ª—è –º–æ–¥–µ–ª–µ–π
model OrderItem { ... }      // PascalCase —Å–æ—Å—Ç–∞–≤–Ω—ã–µ

// –ü–æ–ª—è ‚Äî camelCase
firstName String
createdAt DateTime
isActive  Boolean

// Enum ‚Äî UPPER_SNAKE –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π
enum OrderStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

// –¢–∞–±–ª–∏—Ü—ã ‚Äî snake_case —á–µ—Ä–µ–∑ @@map
model OrderItem {
  ...
  @@map("order_items")
}
```

### ID —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

```prisma
// ‚úÖ CUID ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è (–∫–æ—Ä–æ—á–µ UUID, —Å–æ—Ä—Ç–∏—Ä—É–µ–º—ã–π)
id String @id @default(cuid())

// ‚úÖ UUID ‚Äî –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
id String @id @default(uuid())

// ‚ö†Ô∏è Auto-increment ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü
id Int @id @default(autoincrement())
```

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è

```prisma
// ‚úÖ –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π timestamps
model Entity {
  id        String   @id @default(cuid())
  // ... –ø–æ–ª—è
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

---

## üìä –ò–ù–î–ï–ö–°–´

### –ö–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è—Ç—å –∏–Ω–¥–µ–∫—Å—ã

```prisma
// ‚úÖ –ü–æ–ª—è –¥–ª—è –ø–æ–∏—Å–∫–∞
@@index([email])
@@index([slug])

// ‚úÖ –ü–æ–ª—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
@@index([status])
@@index([isActive])
@@index([categoryId])

// ‚úÖ –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
@@index([isActive, createdAt])
@@index([userId, status])

// ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
email String @unique
slug  String @unique

// ‚úÖ –°–æ—Å—Ç–∞–≤–Ω–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π
@@unique([productId, variantId])
```

### –ß—Ç–æ –ù–ï –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å

```prisma
// ‚ùå –ù–µ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–π:
// - –ü–æ–ª—è —Å –Ω–∏–∑–∫–æ–π –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é (boolean —Å 50/50)
// - –†–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ WHERE
// - –ë–æ–ª—å—à–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è (description)
```

---

## üîÑ –ú–ò–ì–†–ê–¶–ò–ò

### Workflow –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# 1. –ò–∑–º–µ–Ω–∏—Ç—å schema.prisma

# 2. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (development)
npx prisma migrate dev --name add_user_role

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (production)
npx prisma migrate deploy

# 4. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç
npx prisma generate
```

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞
add_users_table
add_user_email_index
add_order_status_column
rename_price_to_amount
remove_deprecated_field

# ‚ùå –ü–õ–û–•–û
update
fix
changes
migration1
```

### –û–ø–∞—Å–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```prisma
// ‚ö†Ô∏è –û–°–¢–û–†–û–ñ–ù–û ‚Äî –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö

// –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏
// –°–ù–ê–ß–ê–õ–ê: —É–±–µ–¥–∏—Å—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω—É–∂–Ω—ã –∏–ª–∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã

// –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏  
// –ò–°–ü–û–õ–¨–ó–£–ô: @map –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
model User {
  firstName String @map("first_name") // –ë—ã–ª–æ first_name –≤ –ë–î
}

// –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞
// –°–û–ó–î–ê–ô: –Ω–æ–≤—É—é –∫–æ–ª–æ–Ω–∫—É, –º–∏–≥—Ä–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ, —É–¥–∞–ª–∏ —Å—Ç–∞—Ä—É—é
```

---

## üìù –ó–ê–ü–†–û–°–´ PRISMA

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

```typescript
// ‚úÖ Select —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
const users = await prisma.user.findMany({
  select: {
    id: true,
    name: true,
    email: true,
  },
});

// ‚úÖ Include –¥–ª—è —Å–≤—è–∑–µ–π
const order = await prisma.order.findUnique({
  where: { id: orderId },
  include: {
    items: true,
    user: {
      select: { id: true, name: true, email: true },
    },
  },
});

// ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è
const products = await prisma.product.findMany({
  skip: (page - 1) * limit,
  take: limit,
  orderBy: { createdAt: 'desc' },
});

// ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
const [order, payment] = await prisma.$transaction([
  prisma.order.create({ data: orderData }),
  prisma.payment.create({ data: paymentData }),
]);

// ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
const result = await prisma.$transaction(async (tx) => {
  const product = await tx.product.findUnique({ where: { id } });
  
  if (product.stock < quantity) {
    throw new Error('Insufficient stock');
  }
  
  await tx.product.update({
    where: { id },
    data: { stock: { decrement: quantity } },
  });
  
  return tx.orderItem.create({ data: itemData });
});
```

### –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã

```typescript
// ‚ùå N+1 –ø—Ä–æ–±–ª–µ–º–∞
const orders = await prisma.order.findMany();
for (const order of orders) {
  const items = await prisma.orderItem.findMany({
    where: { orderId: order.id },
  }); // N –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤!
}

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π include
const orders = await prisma.order.findMany({
  include: { items: true },
});

// ‚ùå –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
const allProducts = await prisma.product.findMany(); // –ú–∏–ª–ª–∏–æ–Ω—ã –∑–∞–ø–∏—Å–µ–π!

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π –ø–∞–≥–∏–Ω–∞—Ü–∏—é
const products = await prisma.product.findMany({
  take: 100,
  skip: offset,
});

// ‚ùå Raw SQL –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
const users = await prisma.$queryRaw`SELECT * FROM users WHERE ...`;

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π Prisma Query API
const users = await prisma.user.findMany({
  where: { ... },
});
```

---

## üîí –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### –ó–∞—â–∏—Ç–∞ –æ—Ç SQL Injection

```typescript
// ‚úÖ Prisma –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
const user = await prisma.user.findFirst({
  where: { email: userInput }, // –ë–µ–∑–æ–ø–∞—Å–Ω–æ
});

// ‚ö†Ô∏è Raw SQL ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
const result = await prisma.$queryRaw`
  SELECT * FROM users WHERE email = ${userInput}
`; // Prisma —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç

// ‚ùå –ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∏—Ä—É–π —Å—Ç—Ä–æ–∫–∏
const result = await prisma.$queryRawUnsafe(
  `SELECT * FROM users WHERE email = '${userInput}'` // SQL INJECTION!
);
```

### –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

```prisma
model Product {
  id        String    @id @default(cuid())
  // ...
  deletedAt DateTime? // null = –∞–∫—Ç–∏–≤–µ–Ω, –¥–∞—Ç–∞ = —É–¥–∞–ª—ë–Ω
  
  @@index([deletedAt])
}
```

```typescript
// Middleware –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
prisma.$use(async (params, next) => {
  if (params.model === 'Product') {
    if (params.action === 'findMany' || params.action === 'findFirst') {
      params.args.where = {
        ...params.args.where,
        deletedAt: null,
      };
    }
  }
  return next(params);
});
```

---

## üíæ BACKUP –ò –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è –±—ç–∫–∞–ø–æ–≤

```markdown
## –¢–∏–ø—ã –±—ç–∫–∞–ø–æ–≤

| –¢–∏–ø | –ß–∞—Å—Ç–æ—Ç–∞ | Retention | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|-----|---------|-----------|-------------------|
| Full backup | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ | 30 –¥–Ω–µ–π | –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ |
| Incremental | –ö–∞–∂–¥—ã–π —á–∞—Å | 7 –¥–Ω–µ–π | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ç–æ—á–∫—É |
| WAL archiving | –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ | 7 –¥–Ω–µ–π | Point-in-time recovery |
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—ç–∫–∞–ø–æ–≤ PostgreSQL

```bash
# –ü–æ–ª–Ω—ã–π –±—ç–∫–∞–ø
pg_dump -h localhost -U user -d database -F c -f backup_$(date +%Y%m%d).dump

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
pg_restore -h localhost -U user -d database -c backup_20240115.dump

# –ë—ç–∫–∞–ø —Ç–æ–ª—å–∫–æ —Å—Ö–µ–º—ã
pg_dump -h localhost -U user -d database --schema-only -f schema.sql

# –ë—ç–∫–∞–ø —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã—Ö
pg_dump -h localhost -U user -d database --data-only -f data.sql
```

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (Docker/Kubernetes)

```yaml
# docker-compose.yml ‚Äî backup service
services:
  backup:
    image: postgres:15-alpine
    environment:
      PGHOST: postgres
      PGUSER: ${DB_USER}
      PGPASSWORD: ${DB_PASSWORD}
      PGDATABASE: ${DB_NAME}
    volumes:
      - ./backups:/backups
    command: |
      sh -c 'while true; do
        pg_dump -F c -f /backups/backup_$$(date +%Y%m%d_%H%M%S).dump
        find /backups -mtime +30 -delete
        sleep 86400
      done'
```

### üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: Restore Testing

```markdown
## Checklist —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### –ï–∂–µ–º–µ—Å—è—á–Ω–æ
- [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –±—ç–∫–∞–ø –≤ —Ç–µ—Å—Ç–æ–≤—É—é –ë–î
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- [ ] –ó–∞–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (RTO)
- [ ] –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- [ ] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ –∫–ª—é—á–µ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö —Å–æ–≤–ø–∞–¥–∞–µ—Ç
- [ ] –°–≤—è–∑–∏ (FK) –Ω–µ –Ω–∞—Ä—É—à–µ–Ω—ã
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –∑–∞–∫–∞–∑—ã, –ø–ª–∞—Ç–µ–∂–∏)
```

### Runbook –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

```markdown
## –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ—á–∫—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (–∫–∞–∫–æ–π –±—ç–∫–∞–ø)
- –£–≤–µ–¥–æ–º–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –æ downtime
- –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —á–∏—Å—Ç—É—é –ë–î –∏–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é

### 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
\`\`\`bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker-compose stop app

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–î
pg_restore -h localhost -U user -d database -c backup.dump

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
psql -h localhost -U user -d database -c "SELECT COUNT(*) FROM users;"

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker-compose start app
\`\`\`

### 3. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å
- [ ] Health checks –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] Smoke tests –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ –Ω–æ—Ä–º–µ

### 4. –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è
- –£–≤–µ–¥–æ–º–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
- –°–æ–∑–¥–∞—Ç—å incident report
```

### –ú–µ—Ç—Ä–∏–∫–∏ –±—ç–∫–∞–ø–æ–≤

```typescript
// –ß—Ç–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å
const backupMetrics = {
  lastBackupTime: Date,        // –ö–æ–≥–¥–∞ –±—ã–ª –ø–æ—Å–ª–µ–¥–Ω–∏–π –±—ç–∫–∞–ø
  backupSize: number,          // –†–∞–∑–º–µ—Ä –±—ç–∫–∞–ø–∞
  backupDuration: number,      // –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞
  lastRestoreTest: Date,       // –ö–æ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
  restoreDuration: number,     // –í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (RTO)
};

// –ê–ª–µ—Ä—Ç—ã
// - –ë—ç–∫–∞–ø –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª—Å—è > 24 —á–∞—Å–æ–≤
// - Restore test –Ω–µ –ø—Ä–æ–≤–æ–¥–∏–ª—Å—è > 30 –¥–Ω–µ–π
// - –†–∞–∑–º–µ—Ä –±—ç–∫–∞–ø–∞ –∞–Ω–æ–º–∞–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª—Å—è
```

---

## ‚òÅÔ∏è NEON (MANAGED POSTGRES)

> –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Neon ‚Äî –º–Ω–æ–≥–∏–µ —Å–µ–∫—Ü–∏–∏ –≤—ã—à–µ —É–ø—Ä–æ—â–∞—é—Ç—Å—è.

### –ß—Ç–æ Neon –¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

```markdown
## –ë—ç–∫–∞–ø—ã
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã (–Ω–µ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å)
- ‚úÖ Point-in-time recovery (–¥–æ 7/30 –¥–Ω–µ–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–ª–∞–Ω–∞)
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–µ—Å—Ç–µ (S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)

## Branching
- ‚úÖ Database branches (–∫–∞–∫ git branches –¥–ª—è –ë–î)
- ‚úÖ Preview environments —Å –æ—Ç–¥–µ–ª—å–Ω–æ–π –ë–î
- ‚úÖ Instant branching (copy-on-write)

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ Autoscaling compute
- ‚úÖ Scale to zero (—ç–∫–æ–Ω–æ–º–∏—è –Ω–∞ dev)
- ‚úÖ Read replicas (–Ω–∞ Pro –ø–ª–∞–Ω–µ)
```

### Neon Branching –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –í–º–µ—Å—Ç–æ docker-compose —Å –ª–æ–∫–∞–ª—å–Ω—ã–º Postgres:
# 1. Main branch = production
# 2. Dev branch = –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
# 3. PR branches = –¥–ª—è preview deployments

# –°–æ–∑–¥–∞–Ω–∏–µ branch —á–µ—Ä–µ–∑ Neon CLI
neonctl branches create --name feature-auth

# –ò–ª–∏ —á–µ—Ä–µ–∑ Vercel Integration ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ PR
```

### Connection String

```typescript
// .env.local (development)
DATABASE_URL="postgresql://user:pass@ep-xxx-123.us-east-2.aws.neon.tech/neondb?sslmode=require"

// Prisma ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è serverless
// schema.prisma
datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")  // –î–ª—è –º–∏–≥—Ä–∞—Ü–∏–π (–±–µ–∑ connection pooling)
}
```

### –ß—Ç–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å

```markdown
## –í–∞—à–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å

- ‚úÖ –°—Ö–µ–º–∞ –ë–î –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ (Prisma)
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–±–µ–∑ N+1)
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≥–¥–µ –Ω—É–∂–Ω–æ
- ‚úÖ Soft delete –¥–ª—è –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –ù–ï –Ω—É–∂–Ω–æ (Neon –¥–µ–ª–∞–µ—Ç)

- ‚ùå –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –±—ç–∫–∞–ø—ã
- ‚ùå docker-compose –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
- ‚ùå Restore testing (Neon –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç)
- ‚ùå –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
```

### Neon + Vercel Integration

```markdown
## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

1. Preview deployment ‚Üí Neon —Å–æ–∑–¥–∞—ë—Ç branch
2. PR merged ‚Üí branch —É–¥–∞–ª—è–µ—Ç—Å—è
3. Environment variables –ø—Ä–æ–∫–∏–¥—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

---

## üõ°Ô∏è –†–û–õ–ò –ò –õ–ò–ú–ò–¢–´ POSTGRES

> –ü—Ä–∏–Ω—Ü–∏–ø –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π: runtime –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ù–ï –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–¥ owner/superuser.

### –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ

Owner-—Ä–æ–ª—å (—Å–æ–∑–¥–∞—ë—Ç—Å—è Neon –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏) –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ `CREATE`, `DROP`, `ALTER` ‚Äî –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î. –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω–æ (RCE, SQL injection —á–µ—Ä–µ–∑ `$queryRawUnsafe`), –∞—Ç–∞–∫—É—é—â–∏–π –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å—Ö–µ–º–æ–π. –í—ã–¥–µ–ª–µ–Ω–Ω—ã–π `app_user` —Å DML-only –ø—Ä–∞–≤–∞–º–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç blast radius.

### –ú–∞—Ç—Ä–∏—Ü–∞ —Ä–æ–ª–µ–π –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º –ø—Ä–æ–µ–∫—Ç–æ–≤

| –†–æ–ª—å | Size A (–º–∞–ª—ã–π) | Size B (—Å—Ä–µ–¥–Ω–∏–π) | Size C (–∫—Ä—É–ø–Ω—ã–π) |
|------|---------------|------------------|------------------|
| **owner** (Neon default) | –ú–∏–≥—Ä–∞—Ü–∏–∏, —Ä—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ | –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤ CI/CD | –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤ CI/CD |
| **app_user** | ‚úÖ Runtime –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | ‚úÖ Runtime –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | ‚úÖ Runtime –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| **readonly_user** | ‚ùå –ù–µ –Ω—É–∂–Ω–∞ | ‚ö†Ô∏è –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞) | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –ø–æ–¥–¥–µ—Ä–∂–∫–∞) |
| **analytics_user** | ‚ùå –ù–µ –Ω—É–∂–Ω–∞ | ‚ùå –ù–µ –Ω—É–∂–Ω–∞ | ‚ö†Ô∏è –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–¥–ª–∏–Ω–Ω—ã–µ –æ—Ç—á—ë—Ç—ã) |

---

### –°–æ–∑–¥–∞–Ω–∏–µ runtime –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (app_user)

> üî¥ **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –≤—Å–µ—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤ (A/B/C)**

```sql
-- 1. –°–æ–∑–¥–∞—Ç—å runtime —Ä–æ–ª—å
CREATE ROLE app_user WITH LOGIN PASSWORD '<—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å: openssl rand -base64 32>';

-- 2. –î–æ—Å—Ç—É–ø –∫ –ë–î –∏ —Å—Ö–µ–º–µ
GRANT CONNECT ON DATABASE neondb TO app_user;
GRANT USAGE ON SCHEMA public TO app_user;

-- 3. DML-only –ø—Ä–∞–≤–∞ (SELECT, INSERT, UPDATE, DELETE)
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO app_user;

-- 4. –ü—Ä–∞–≤–∞ –Ω–∞ sequences (–¥–ª—è CUID/autoincrement)
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO app_user;

-- 5. DEFAULT PRIVILEGES ‚Äî —á—Ç–æ–±—ã –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Ç–æ–∂–µ –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
-- ‚ö†Ô∏è –í—ã–ø–æ–ª–Ω—è—Ç—å –û–¢ –ò–ú–ï–ù–ò owner (—Ç–æ–≥–æ –∫—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç prisma migrate deploy)
ALTER DEFAULT PRIVILEGES IN SCHEMA public
  GRANT SELECT, INSERT, UPDATE, DELETE ON TABLES TO app_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public
  GRANT USAGE, SELECT ON SEQUENCES TO app_user;
```

### –°–æ–∑–¥–∞–Ω–∏–µ readonly –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Size B/C)

```sql
-- –î–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, –ø–æ–¥–¥–µ—Ä–∂–∫–∏, –¥–µ–±–∞–≥–∞
CREATE ROLE readonly_user WITH LOGIN PASSWORD '<—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å>';

GRANT CONNECT ON DATABASE neondb TO readonly_user;
GRANT USAGE ON SCHEMA public TO readonly_user;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO readonly_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public
  GRANT SELECT ON TABLES TO readonly_user;
```

### –°–æ–∑–¥–∞–Ω–∏–µ analytics –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Size C)

```sql
-- –î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ ‚Äî –º—è–≥–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã
CREATE ROLE analytics_user WITH LOGIN PASSWORD '<—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å>';

GRANT CONNECT ON DATABASE neondb TO analytics_user;
GRANT USAGE ON SCHEMA public TO analytics_user;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO analytics_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public
  GRANT SELECT ON TABLES TO analytics_user;

-- –ú—è–≥–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
ALTER ROLE analytics_user SET statement_timeout = '5min';
ALTER ROLE analytics_user SET idle_in_transaction_session_timeout = '5min';
ALTER ROLE analytics_user SET lock_timeout = '30s';
ALTER ROLE analytics_user CONNECTION LIMIT 3;
```

---

### CONNECTION LIMIT

> –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ª–∏ –ª–∏–º–∏—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ –¥–µ–ø–ª–æ—è, –∞ –Ω–µ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞.

| –°—Ü–µ–Ω–∞—Ä–∏–π –¥–µ–ø–ª–æ—è | CONNECTION LIMIT | –ü—Ä–∏—á–∏–Ω–∞ |
|-----------------|-----------------|---------|
| **Vercel serverless** (pooled) | ‚ùå –ù–µ —Å—Ç–∞–≤–∏—Ç—å –Ω–∞ —Ä–æ–ª—å | Neon Pooler —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏. –õ–∏–º–∏—Ç –Ω–∞ —Ä–æ–ª–∏ –≤—ã–∑–æ–≤–µ—Ç `too many connections` –ø—Ä–∏ –≤—Å–ø–ª–µ—Å–∫–∞—Ö |
| **NestJS –Ω–∞ Render/Railway** (long-running) | ‚úÖ –°—Ç–∞–≤–∏—Ç—å | –ó–∞—â–∏—Ç–∞ –æ—Ç —É—Ç–µ—á–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –ø—Ä–∏ autoscaling –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ |
| **Monorepo (web + api)** | ‚úÖ –°—Ç–∞–≤–∏—Ç—å –Ω–∞ api, –Ω–µ —Å—Ç–∞–≤–∏—Ç—å –Ω–∞ web | Web —á–µ—Ä–µ–∑ pooler, API ‚Äî direct/pooled —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º |

#### –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á—ë—Ç–∞ CONNECTION LIMIT

```
CONNECTION LIMIT = (–∫–æ–ª-–≤–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ √ó —Ä–∞–∑–º–µ—Ä –ø—É–ª–∞) + –∑–∞–ø–∞—Å (5-10)

–ü—Ä–∏–º–µ—Ä—ã:
- 2 –∏–Ω—Å—Ç–∞–Ω—Å–∞ NestJS √ó 10 –ø—É–ª = 20 + 10 –∑–∞–ø–∞—Å = 30
- 3 –∏–Ω—Å—Ç–∞–Ω—Å–∞ √ó 15 –ø—É–ª = 45 + 10 –∑–∞–ø–∞—Å = 55
```

#### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Size A | Size B | Size C |
|----------|--------|--------|--------|
| CONNECTION LIMIT (long-running backend) | 15 | 30 | 50-100 |
| Prisma `connection_limit` (serverless) | 3-5 | 5-10 | 10-15 |
| Prisma `connection_limit` (long-running) | 5-10 | 10-15 | 15-25 |
| Prisma `pool_timeout` | 10s | 15s | 15s |

```sql
-- Size A (NestJS backend)
ALTER ROLE app_user CONNECTION LIMIT 15;

-- Size B (NestJS backend)
ALTER ROLE app_user CONNECTION LIMIT 30;

-- Size C (NestJS backend, –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤)
ALTER ROLE app_user CONNECTION LIMIT 55;
```

---

### –¢–∞–π–º–∞—É—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ä–æ–ª–∏ Postgres

> Defence-in-depth: —Ç–∞–π–º–∞—É—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ä–æ–ª–∏ –¥–æ–ø–æ–ª–Ω—è—é—Ç application-level —Ç–∞–π–º–∞—É—Ç—ã –∏–∑ `18-reliability.mdc`.

```sql
-- ‚è±Ô∏è statement_timeout ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
-- ‚è±Ô∏è idle_in_transaction_session_timeout ‚Äî —É–±–∏—Ç—å idle —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
-- ‚è±Ô∏è lock_timeout ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
```

#### –¢–∞–±–ª–∏—Ü–∞ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º –∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Size A (serverless) | Size A (backend) | Size B | Size C |
|----------|--------------------|-----------------:|-------:|-------:|
| `statement_timeout` | `10s` | `15s` | `30s` | `30s` |
| `idle_in_transaction_session_timeout` | `20s` | `30s` | `60s` | `60s` |
| `lock_timeout` | `5s` | `5s` | `10s` | `10s` |

#### Size A ‚Äî –ú–∞–ª—ã–π –ø—Ä–æ–µ–∫—Ç

```sql
-- Vercel serverless (–∂—ë—Å—Ç–∫–∏–µ –ª–∏–º–∏—Ç—ã ‚Äî serverless functions –∏–º–µ—é—Ç —Å–≤–æ–π timeout)
ALTER ROLE app_user SET statement_timeout = '10s';
ALTER ROLE app_user SET idle_in_transaction_session_timeout = '20s';
ALTER ROLE app_user SET lock_timeout = '5s';
```

```sql
-- NestJS backend (—á—É—Ç—å –º—è–≥—á–µ)
ALTER ROLE app_user SET statement_timeout = '15s';
ALTER ROLE app_user SET idle_in_transaction_session_timeout = '30s';
ALTER ROLE app_user SET lock_timeout = '5s';
```

#### Size B ‚Äî –°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–µ–∫—Ç

```sql
ALTER ROLE app_user SET statement_timeout = '30s';
ALTER ROLE app_user SET idle_in_transaction_session_timeout = '60s';
ALTER ROLE app_user SET lock_timeout = '10s';
```

#### Size C ‚Äî –ö—Ä—É–ø–Ω—ã–π –ø—Ä–æ–µ–∫—Ç

```sql
-- app_user ‚Äî —Ç–∞–∫–∏–µ –∂–µ –∫–∞–∫ Size B
ALTER ROLE app_user SET statement_timeout = '30s';
ALTER ROLE app_user SET idle_in_transaction_session_timeout = '60s';
ALTER ROLE app_user SET lock_timeout = '10s';

-- analytics_user ‚Äî –º—è–≥–∫–∏–µ –ª–∏–º–∏—Ç—ã –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤
ALTER ROLE analytics_user SET statement_timeout = '5min';
ALTER ROLE analytics_user SET idle_in_transaction_session_timeout = '5min';
ALTER ROLE analytics_user SET lock_timeout = '30s';
```

---

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Ä–æ–ª–µ–π

#### Vercel Fullstack (Size A/B)

```bash
# Runtime ‚Äî app_user —á–µ—Ä–µ–∑ pooler
DATABASE_URL="postgresql://app_user:pass@ep-xxx-pooler.neon.tech/neondb?sslmode=require&connection_limit=5&pool_timeout=10"

# –ú–∏–≥—Ä–∞—Ü–∏–∏ ‚Äî owner –Ω–∞–ø—Ä—è–º—É—é (—Ç–æ–ª—å–∫–æ CI/CD –∏ —Ä—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
DIRECT_URL="postgresql://neon_owner:pass@ep-xxx.neon.tech/neondb?sslmode=require"
```

#### Vercel Frontend + NestJS Backend (Size B/C)

```bash
# NestJS (.env –Ω–∞ Render/Railway) ‚Äî app_user —á–µ—Ä–µ–∑ pooler
DATABASE_URL="postgresql://app_user:pass@ep-xxx-pooler.neon.tech/neondb?sslmode=require&connection_limit=10&pool_timeout=15"

# –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤ CI/CD ‚Äî owner
DIRECT_URL="postgresql://neon_owner:pass@ep-xxx.neon.tech/neondb?sslmode=require"
```

---

### ‚ö†Ô∏è –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏

#### 1. DEFAULT PRIVILEGES –∏ Prisma migrate

`ALTER DEFAULT PRIVILEGES` –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ —Ç–∞–±–ª–∏—Ü–∞–º, —Å–æ–∑–¥–∞–Ω–Ω—ã–º **—Ç–µ–∫—É—â–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º**. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:
- `ALTER DEFAULT PRIVILEGES` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—Ç –∏–º–µ–Ω–∏ —Ç–æ–≥–æ –∂–µ owner, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç `prisma migrate deploy`
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ `app_user` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –Ω–æ–≤—ã–º —Ç–∞–±–ª–∏—Ü–∞–º

#### 2. Neon Branching –∏ —Ä–æ–ª–∏

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Neon branch —Ä–æ–ª–∏ **–∫–æ–ø–∏—Ä—É—é—Ç—Å—è** —Å –¥–∞–Ω–Ω—ã–º–∏, –Ω–æ:
- –ü–∞—Ä–æ–ª–∏ —Ä–æ–ª–µ–π, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –≤—Ä—É—á–Ω—É—é, **–º–æ–≥—É—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å** –≤ preview branches —á–µ—Ä–µ–∑ Vercel Integration
- –†–µ—à–µ–Ω–∏–µ –¥–ª—è Size A/B: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω –ø–∞—Ä–æ–ª—å `app_user` –¥–ª—è –≤—Å–µ—Ö branches
- –†–µ—à–µ–Ω–∏–µ –¥–ª—è Size C: —Å–∫—Ä–∏–ø—Ç –≤ CI, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç/–ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª–∏ –≤ –∫–∞–∂–¥–æ–º branch

```bash
# CI —Å–∫—Ä–∏–ø—Ç –¥–ª—è preview branches (Size C)
neonctl query "DO \$\$ BEGIN
  IF NOT EXISTS (SELECT FROM pg_roles WHERE rolname = 'app_user') THEN
    CREATE ROLE app_user WITH LOGIN PASSWORD '$APP_USER_PASSWORD';
  END IF;
END \$\$;" --project-id $NEON_PROJECT_ID --branch $BRANCH_NAME
```

#### 3. idle_in_transaction –∏ Prisma interactive transactions

Prisma `$transaction(async (tx) => { ... })` –¥–µ—Ä–∂–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –æ—Ç–∫—Ä—ã—Ç–æ–π –Ω–∞ –≤—Ä–µ–º—è callback. –ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ –µ—Å—Ç—å –≤–Ω–µ—à–Ω–∏–µ –≤—ã–∑–æ–≤—ã (API payment, email) ‚Äî –º–æ–∂–Ω–æ –≤—ã–ª–µ—Ç–µ—Ç—å –ø–æ `idle_in_transaction_session_timeout`.

```typescript
// ‚ùå –ü–õ–û–•–û ‚Äî –≤–Ω–µ—à–Ω–∏–π –≤—ã–∑–æ–≤ –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
await prisma.$transaction(async (tx) => {
  const order = await tx.order.create({ data: orderData });
  await paymentService.charge(order.id); // –ú–æ–∂–µ—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å!
  await tx.order.update({ where: { id: order.id }, data: { status: 'PAID' } });
});

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –≤–Ω–µ—à–Ω–∏–µ –≤—ã–∑–æ–≤—ã –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
const order = await prisma.order.create({ data: orderData });
const payment = await paymentService.charge(order.id);
await prisma.order.update({ where: { id: order.id }, data: { status: 'PAID' } });
```

#### 4. CONNECTION LIMIT –∏ autoscaling

–ü—Ä–∏ —Ä–æ—Å—Ç–µ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ (Size B ‚Üí C) –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å `CONNECTION LIMIT`:
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ `pg_stat_activity` –∏–ª–∏ Neon Dashboard ‚Üí Connections
- –ê–ª–µ—Ä—Ç –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ > 80% –ª–∏–º–∏—Ç–∞
- –û–±–Ω–æ–≤–ª—è–π—Ç–µ –ª–∏–º–∏—Ç –î–û –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤

---

## üìã CHECKLIST

### –ü–µ—Ä–µ–¥ production

- [ ] –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- [ ] –ù–µ—Ç N+1 –ø—Ä–æ–±–ª–µ–º
- [ ] –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–ª—è –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] Backup –Ω–∞—Å—Ç—Ä–æ–µ–Ω *(–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –µ—Å–ª–∏ Neon)*
- [ ] **Restore testing –ø—Ä–æ–≤–µ–¥—ë–Ω** *(–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –µ—Å–ª–∏ Neon)*
- [ ] **RTO/RPO –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã** *(Neon: RPO ~0, RTO –º–∏–Ω—É—Ç—ã)*

### –†–æ–ª–∏ –∏ –ª–∏–º–∏—Ç—ã Checklist

#### –í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã (A/B/C)

- [ ] `app_user` —Å–æ–∑–¥–∞–Ω —Å DML-only –ø—Ä–∞–≤–∞–º–∏
- [ ] `DEFAULT PRIVILEGES` –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –æ—Ç –∏–º–µ–Ω–∏ owner
- [ ] `DATABASE_URL` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `app_user` (–Ω–µ owner)
- [ ] `DIRECT_URL` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç owner (—Ç–æ–ª—å–∫–æ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π)
- [ ] `statement_timeout` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ `app_user`
- [ ] `idle_in_transaction_session_timeout` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ `app_user`
- [ ] `lock_timeout` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ `app_user`
- [ ] –ü–∞—Ä–æ–ª—å `app_user` —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ (`openssl rand -base64 32`)

#### –°—Ä–µ–¥–Ω–∏–µ –∏ –∫—Ä—É–ø–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã (B/C)

- [ ] `readonly_user` —Å–æ–∑–¥–∞–Ω *(–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏/–ø–æ–¥–¥–µ—Ä–∂–∫–∏)*
- [ ] `CONNECTION LIMIT` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω *(–µ—Å–ª–∏ long-running backend)*
- [ ] –§–æ—Ä–º—É–ª–∞ –ª–∏–º–∏—Ç–∞ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ *(–∏–Ω—Å—Ç–∞–Ω—Å—ã √ó –ø—É–ª + –∑–∞–ø–∞—Å)*

#### –ö—Ä—É–ø–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã (C)

- [ ] `analytics_user` —Å–æ–∑–¥–∞–Ω *(–µ—Å–ª–∏ –Ω—É–∂–Ω—ã –¥–ª–∏–Ω–Ω—ã–µ –æ—Ç—á—ë—Ç—ã)*
- [ ] CI —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–æ–ª–µ–π –≤ preview branches
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ `pg_stat_activity` –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ê–ª–µ—Ä—Ç –Ω–∞ > 80% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CONNECTION LIMIT

### Backup Checklist (self-hosted)

> –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Neon –∏–ª–∏ –¥—Ä—É–≥–æ–π managed —Å–µ—Ä–≤–∏—Å

- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Retention policy –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
- [ ] –ë—ç–∫–∞–ø—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–µ—Å—Ç–µ (–Ω–µ –Ω–∞ —Ç–æ–º –∂–µ —Å–µ—Ä–≤–µ—Ä–µ)
- [ ] Restore testing –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ (–º–∏–Ω–∏–º—É–º –µ–∂–µ–º–µ—Å—è—á–Ω–æ)
- [ ] Runbook –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] –ê–ª–µ—Ä—Ç—ã –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –±—ç–∫–∞–ø–æ–≤

### Neon Checklist

- [ ] –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–ª–∞–Ω –≤—ã–±—Ä–∞–Ω (Free/Pro/Scale)
- [ ] Vercel Integration –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ (–µ—Å–ª–∏ Vercel)
- [ ] Connection pooling –≤–∫–ª—é—á—ë–Ω
- [ ] `directUrl` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π

---

**–í–µ—Ä—Å–∏—è:** 1.3
**–î–∞—Ç–∞:** 2026-02-12
